<div class="w-full h-screen flex flex-col bg-neutral-800">
  <app-header></app-header>

  <section
    class="relative w-full h-full overflow-y-scroll flex flex-col-reverse hide-scrollbar"
  >
    <ul class="flex flex-col-reverse w-full pb-4">
      @if (messagesDisplay().length === 0 && !loadingMessages) {
      <div
        class="absolute inset-0 flex flex-col items-center justify-center text-center text-neutral-400 p-4"
      >
        <i class="pi pi-inbox mb-2 text-4xl! text-neutral-600"></i>
        Nenhuma mensagem ainda. Seja o primeiro a enviar uma!
      </div>
      } @else if (loadingMessages) {
      <div
        class="absolute inset-0 flex items-center justify-center text-neutral-400"
      >
        <i class="pi pi-spin pi-spinner text-4xl!"></i>
      </div>
      } @for (display of messagesDisplay(); track display.message.id) {
      <li>
        @if (display.showDateSeparator) {
        <div
          class="w-full text-sm flex items-center px-4 gap-2 text-neutral-400 [&_hr]:w-full [&_hr]:border-t [&_hr]:border-t-neutral-700"
        >
          <hr />
          {{ dateSeparator(display.message.created_at) }}
          <hr />
        </div>
        }
        <app-message
          [message]="display.message"
          [diffTime]="display.diffTime"
        ></app-message>
      </li>
      }
    </ul>
  </section>

  @if (isMobile()) {
  <div
    class="w-full flex items-center border-t border-t-neutral-700/50 h-18 min-h-fit max-h-32 p-2 pb-4 gap-2"
  >
    <div
      class="w-full flex items-center bg-neutral-700/40 max-h-32 overflow-y-scroll hide-scrollbar rounded-2xl min-h-[47px]"
    >
      <textarea
        pTextarea
        rows="1"
        [maxlength]="500"
        fluid
        [placeholder]="inputPlaceholder()"
        [autoResize]="true"
        [(ngModel)]="newMessageContent"
        [dt]="inputThemes.outlined"
        [style]="{ border: '0', backgroundColor: 'transparent' }"
        class="flex-1!"
      ></textarea>
    </div>
    <p-button
      icon="pi pi-send"
      [dt]="buttonThemes.primary"
      styleClass="rounded-full!"
      (click)="sendMessage()"
    ></p-button>
  </div>
  } @else {
  <div class="w-full p-2">
    <div
      class="w-full flex items-start bg-neutral-600/20 border border-neutral-700/50 min-h-14 rounded-lg pt-1.5 pl-2"
    >
      <p-button
        icon="pi pi-plus"
        [dt]="buttonThemes.ghost"
        styleClass="bg-transparent!"
        (click)="op.toggle($event)"
      ></p-button>
      @if (newMessageFileUrl) {
      <div
        class="flex items-center gap-2 px-2 py-1 rounded-full border border-neutral-600 text-neutral-300 mt-1"
      >
        <img [src]="newMessageFileUrl" class="size-6 object-contain" />
        <button
          class="text-neutral-400 hover:text-neutral-200"
          (click)="newMessageFileUrl = null; op.hide()"
        >
          <i class="pi pi-times text-xs!"></i>
        </button>
      </div>
      }
      <p-popover #op [dt]="popoverThemes.ghost"
        ><div>
          <span
            class="font-medium text-surface-900 dark:text-surface-0 block mb-2"
            >Adicione uma imagem</span
          >
          <p-inputgroup>
            <p-inputgroup-addon
              styleClass="bg-neutral-800! border-neutral-600!"
            >
              www
            </p-inputgroup-addon>
            <input
              pInputText
              fluid
              [(ngModel)]="tempFileUrl"
              [dt]="inputThemes.outlined"
            />
            <p-inputgroup-addon styleClass="border-[#4752C4]!">
              <p-button
                icon="pi pi-plus"
                [dt]="buttonThemes.primary"
                (click)="
                  newMessageFileUrl = tempFileUrl; tempFileUrl = null; op.hide()
                "
              />
            </p-inputgroup-addon>
          </p-inputgroup>
        </div>
      </p-popover>
      <textarea
        pTextarea
        rows="1"
        [maxlength]="500"
        fluid
        [placeholder]="inputPlaceholder()"
        [autoResize]="true"
        [(ngModel)]="newMessageContent"
        (keydown.enter)="$event.preventDefault(); sendMessage()"
        [dt]="inputThemes.outlined"
        [style]="{ border: '0', backgroundColor: 'transparent' }"
      ></textarea>
    </div>
  </div>
  }
</div>
